import { parseExitCodes } from "../exitCodeParser";
import { readFileSync } from "fs";
import * as fs from "fs";
import { it, describe, expect } from "vitest";

const code =
  "OzsgSmV0dG9uIFdhbGxldCBTbWFydCBDb250cmFjdAoKey0KCk5PVEUgdGhhdCB0aGlzIHRva2VucyBjYW4gYmUgdHJhbnNmZXJyZWQgd2l0aGluIHRoZSBzYW1lIHdvcmtjaGFpbi4KClRoaXMgaXMgc3VpdGFibGUgZm9yIG1vc3QgdG9rZW5zLCBpZiB5b3UgbmVlZCB0b2tlbnMgdHJhbnNmZXJhYmxlIGJldHdlZW4gd29ya2NoYWlucyB0aGVyZSBhcmUgdHdvIHNvbHV0aW9uczoKCjEpIHVzZSBtb3JlIGV4cGVuc2l2ZSBidXQgdW5pdmVyc2FsIGZ1bmN0aW9uIHRvIGNhbGN1bGF0ZSBtZXNzYWdlIGZvcndhcmQgZmVlIGZvciBhcmJpdHJhcnkgZGVzdGluYXRpb24gKHNlZSBgbWlzYy9mb3J3YXJkLWZlZS1jYWxjLmNzYCkKCjIpIHVzZSB0b2tlbiBob2xkZXIgcHJveGllcyBpbiB0YXJnZXQgd29ya2NoYWluICh0aGF0IHdheSBldmVuICdub24tdW5pdmVyc2FsJyB0b2tlbiBjYW4gYmUgdXNlZCBmcm9tIGFueSB3b3JrY2hhaW4pCgotfQoKI3ByYWdtYSB2ZXJzaW9uID49MC4yLjA7CgojaW5jbHVkZSAiaW1wb3J0cy9zdGRsaWIuZmMiOwojaW5jbHVkZSAiaW1wb3J0cy91dGlscy5mYyI7CiNpbmNsdWRlICJpbXBvcnRzL29wLWNvZGVzLmZjIjsKCmludCBtaW5fdG9uc19mb3Jfc3RvcmFnZSgpIGFzbSAiMTAwMDAwMDAgUFVTSElOVCI7IDs7IDAuMDEgVE9OCmludCBnYXNfY29uc3VtcHRpb24oKSBhc20gIjEwMDAwMDAwIFBVU0hJTlQiOyA7OyAwLjAxIFRPTgoKey0KICBTdG9yYWdlCiAgc3RvcmFnZSNfIGJhbGFuY2U6KFZhclVJbnRlZ2VyIDE2KSBvd25lcl9hZGRyZXNzOk1zZ0FkZHJlc3NJbnQgamV0dG9uX21hc3Rlcl9hZGRyZXNzOk1zZ0FkZHJlc3NJbnQgamV0dG9uX3dhbGxldF9jb2RlOl5DZWxsID0gU3RvcmFnZTsKLX0KCihpbnQsIHNsaWNlLCBzbGljZSwgY2VsbCkgbG9hZF9kYXRhKCkgaW5saW5lIHsKICBzbGljZSBkcyA9IGdldF9kYXRhKCkuYmVnaW5fcGFyc2UoKTsKICByZXR1cm4gKGRzfmxvYWRfY29pbnMoKSwgZHN+bG9hZF9tc2dfYWRkcigpLCBkc35sb2FkX21zZ19hZGRyKCksIGRzfmxvYWRfcmVmKCkpOwp9CgooKSBzYXZlX2RhdGEgKGludCBiYWxhbmNlLCBzbGljZSBvd25lcl9hZGRyZXNzLCBzbGljZSBqZXR0b25fbWFzdGVyX2FkZHJlc3MsIGNlbGwgamV0dG9uX3dhbGxldF9jb2RlKSBpbXB1cmUgaW5saW5lIHsKICBzZXRfZGF0YShwYWNrX2pldHRvbl93YWxsZXRfZGF0YShiYWxhbmNlLCBvd25lcl9hZGRyZXNzLCBqZXR0b25fbWFzdGVyX2FkZHJlc3MsIGpldHRvbl93YWxsZXRfY29kZSkpOwp9Cgp7LQogIHRyYW5zZmVyIHF1ZXJ5X2lkOnVpbnQ2NCBhbW91bnQ6KFZhclVJbnRlZ2VyIDE2KSBkZXN0aW5hdGlvbjpNc2dBZGRyZXNzCiAgICAgICAgICAgcmVzcG9uc2VfZGVzdGluYXRpb246TXNnQWRkcmVzcyBjdXN0b21fcGF5bG9hZDooTWF5YmUgXkNlbGwpCiAgICAgICAgICAgZm9yd2FyZF90b25fYW1vdW50OihWYXJVSW50ZWdlciAxNikgZm9yd2FyZF9wYXlsb2FkOihFaXRoZXIgQ2VsbCBeQ2VsbCkKICAgICAgICAgICA9IEludGVybmFsTXNnQm9keTsKLX0KCigpIHNlbmRfdG9rZW5zIChzbGljZSBpbl9tc2dfYm9keSwgc2xpY2Ugc2VuZGVyX2FkZHJlc3MsIGludCBtc2dfdmFsdWUsIGludCBmd2RfZmVlKSBpbXB1cmUgewogIGludCBxdWVyeV9pZCA9IGluX21zZ19ib2R5fmxvYWRfdWludCg2NCk7CiAgaW50IGpldHRvbl9hbW91bnQgPSBpbl9tc2dfYm9keX5sb2FkX2NvaW5zKCk7CiAgc2xpY2UgdG9fb3duZXJfYWRkcmVzcyA9IGluX21zZ19ib2R5fmxvYWRfbXNnX2FkZHIoKTsKICBmb3JjZV9jaGFpbih0b19vd25lcl9hZGRyZXNzKTsKICAoaW50IGJhbGFuY2UsIHNsaWNlIG93bmVyX2FkZHJlc3MsIHNsaWNlIGpldHRvbl9tYXN0ZXJfYWRkcmVzcywgY2VsbCBqZXR0b25fd2FsbGV0X2NvZGUpID0gbG9hZF9kYXRhKCk7CiAgYmFsYW5jZSAtPSBqZXR0b25fYW1vdW50OwoKICB0aHJvd191bmxlc3MoNzA1LCBlcXVhbF9zbGljZXMob3duZXJfYWRkcmVzcywgc2VuZGVyX2FkZHJlc3MpKTsKICB0aHJvd191bmxlc3MoNzA2LCBiYWxhbmNlID49IDApOwoKICBjZWxsIHN0YXRlX2luaXQgPSBjYWxjdWxhdGVfamV0dG9uX3dhbGxldF9zdGF0ZV9pbml0KHRvX293bmVyX2FkZHJlc3MsIGpldHRvbl9tYXN0ZXJfYWRkcmVzcywgamV0dG9uX3dhbGxldF9jb2RlKTsKICBzbGljZSB0b193YWxsZXRfYWRkcmVzcyA9IGNhbGN1bGF0ZV9qZXR0b25fd2FsbGV0X2FkZHJlc3Moc3RhdGVfaW5pdCk7CiAgc2xpY2UgcmVzcG9uc2VfYWRkcmVzcyA9IGluX21zZ19ib2R5fmxvYWRfbXNnX2FkZHIoKTsKICBjZWxsIGN1c3RvbV9wYXlsb2FkID0gaW5fbXNnX2JvZHl+bG9hZF9kaWN0KCk7CiAgaW50IGZvcndhcmRfdG9uX2Ftb3VudCA9IGluX21zZ19ib2R5fmxvYWRfY29pbnMoKTsKICB0aHJvd191bmxlc3MoNzA4LCBzbGljZV9iaXRzKGluX21zZ19ib2R5KSA+PSAxKTsKICBzbGljZSBlaXRoZXJfZm9yd2FyZF9wYXlsb2FkID0gaW5fbXNnX2JvZHk7CiAgdmFyIG1zZyA9IGJlZ2luX2NlbGwoKQogICAgLnN0b3JlX3VpbnQoMHgxOCwgNikKICAgIC5zdG9yZV9zbGljZSh0b193YWxsZXRfYWRkcmVzcykKICAgIC5zdG9yZV9jb2lucygwKQogICAgLnN0b3JlX3VpbnQoNCArIDIgKyAxLCAxICsgNCArIDQgKyA2NCArIDMyICsgMSArIDEgKyAxKQogICAgLnN0b3JlX3JlZihzdGF0ZV9pbml0KTsKICB2YXIgbXNnX2JvZHkgPSBiZWdpbl9jZWxsKCkKICAgIC5zdG9yZV91aW50KG9wOjppbnRlcm5hbF90cmFuc2ZlciwgMzIpCiAgICAuc3RvcmVfdWludChxdWVyeV9pZCwgNjQpCiAgICAuc3RvcmVfY29pbnMoamV0dG9uX2Ftb3VudCkKICAgIC5zdG9yZV9zbGljZShvd25lcl9hZGRyZXNzKQogICAgLnN0b3JlX3NsaWNlKHJlc3BvbnNlX2FkZHJlc3MpCiAgICAuc3RvcmVfY29pbnMoZm9yd2FyZF90b25fYW1vdW50KQogICAgLnN0b3JlX3NsaWNlKGVpdGhlcl9mb3J3YXJkX3BheWxvYWQpCiAgICAuZW5kX2NlbGwoKTsKCiAgbXNnID0gbXNnLnN0b3JlX3JlZihtc2dfYm9keSk7CiAgaW50IGZ3ZF9jb3VudCA9IGZvcndhcmRfdG9uX2Ftb3VudCA/IDIgOiAxOwogIHRocm93X3VubGVzcyg3MDksIG1zZ192YWx1ZSA+CiAgICAgICAgICAgICAgICAgICAgIGZvcndhcmRfdG9uX2Ftb3VudCArCiAgICAgICAgICAgICAgICAgICAgIDs7IDMgbWVzc2FnZXM6IHdhbDEtPndhbDIsICB3YWwyLT5vd25lciwgd2FsMi0+cmVzcG9uc2UKICAgICAgICAgICAgICAgICAgICAgOzsgYnV0IGxhc3Qgb25lIGlzIG9wdGlvbmFsIChpdCBpcyBvayBpZiBpdCBmYWlscykKICAgICAgICAgICAgICAgICAgICAgZndkX2NvdW50ICogZndkX2ZlZSArCiAgICAgICAgICAgICAgICAgICAgICgyICogZ2FzX2NvbnN1bXB0aW9uKCkgKyBtaW5fdG9uc19mb3Jfc3RvcmFnZSgpKSk7CiAgICAgICAgICAgICAgICAgICAgIDs7IHVuaXZlcnNhbCBtZXNzYWdlIHNlbmQgZmVlIGNhbGN1bGF0aW9uIG1heSBiZSBhY3RpdmF0ZWQgaGVyZQogICAgICAgICAgICAgICAgICAgICA7OyBieSB1c2luZyB0aGlzIGluc3RlYWQgb2YgZndkX2ZlZQogICAgICAgICAgICAgICAgICAgICA7OyBtc2dfZndkX2ZlZSh0b193YWxsZXQsIG1zZ19ib2R5LCBzdGF0ZV9pbml0LCAxNSkKCiAgc2VuZF9yYXdfbWVzc2FnZShtc2cuZW5kX2NlbGwoKSwgNjQpOyA7OyByZXZlcnQgb24gZXJyb3JzCiAgc2F2ZV9kYXRhKGJhbGFuY2UsIG93bmVyX2FkZHJlc3MsIGpldHRvbl9tYXN0ZXJfYWRkcmVzcywgamV0dG9uX3dhbGxldF9jb2RlKTsKfQoKey0KICBpbnRlcm5hbF90cmFuc2ZlciAgcXVlcnlfaWQ6dWludDY0IGFtb3VudDooVmFyVUludGVnZXIgMTYpIGZyb206TXNnQWRkcmVzcwogICAgICAgICAgICAgICAgICAgICByZXNwb25zZV9hZGRyZXNzOk1zZ0FkZHJlc3MKICAgICAgICAgICAgICAgICAgICAgZm9yd2FyZF90b25fYW1vdW50OihWYXJVSW50ZWdlciAxNikKICAgICAgICAgICAgICAgICAgICAgZm9yd2FyZF9wYXlsb2FkOihFaXRoZXIgQ2VsbCBeQ2VsbCkgCiAgICAgICAgICAgICAgICAgICAgID0gSW50ZXJuYWxNc2dCb2R5OwotfQoKKCkgcmVjZWl2ZV90b2tlbnMgKHNsaWNlIGluX21zZ19ib2R5LCBzbGljZSBzZW5kZXJfYWRkcmVzcywgaW50IG15X3Rvbl9iYWxhbmNlLCBpbnQgZndkX2ZlZSwgaW50IG1zZ192YWx1ZSkgaW1wdXJlIHsKICA7OyBOT1RFIHdlIGNhbiBub3QgYWxsb3cgZmFpbHMgaW4gYWN0aW9uIHBoYXNlIHNpbmNlIGluIHRoYXQgY2FzZSB0aGVyZSB3aWxsIGJlCiAgOzsgbm8gYm91bmNlLiBUaHVzIGNoZWNrIGFuZCB0aHJvdyBpbiBjb21wdXRhdGlvbiBwaGFzZS4KICAoaW50IGJhbGFuY2UsIHNsaWNlIG93bmVyX2FkZHJlc3MsIHNsaWNlIGpldHRvbl9tYXN0ZXJfYWRkcmVzcywgY2VsbCBqZXR0b25fd2FsbGV0X2NvZGUpID0gbG9hZF9kYXRhKCk7CiAgaW50IHF1ZXJ5X2lkID0gaW5fbXNnX2JvZHl+bG9hZF91aW50KDY0KTsKICBpbnQgamV0dG9uX2Ftb3VudCA9IGluX21zZ19ib2R5fmxvYWRfY29pbnMoKTsKICBiYWxhbmNlICs9IGpldHRvbl9hbW91bnQ7CiAgc2xpY2UgZnJvbV9hZGRyZXNzID0gaW5fbXNnX2JvZHl+bG9hZF9tc2dfYWRkcigpOwogIHNsaWNlIHJlc3BvbnNlX2FkZHJlc3MgPSBpbl9tc2dfYm9keX5sb2FkX21zZ19hZGRyKCk7CiAgdGhyb3dfdW5sZXNzKDcwNywKICAgICAgZXF1YWxfc2xpY2VzKGpldHRvbl9tYXN0ZXJfYWRkcmVzcywgc2VuZGVyX2FkZHJlc3MpCiAgICAgIHwKICAgICAgZXF1YWxfc2xpY2VzKGNhbGN1bGF0ZV91c2VyX2pldHRvbl93YWxsZXRfYWRkcmVzcyhmcm9tX2FkZHJlc3MsIGpldHRvbl9tYXN0ZXJfYWRkcmVzcywgamV0dG9uX3dhbGxldF9jb2RlKSwgc2VuZGVyX2FkZHJlc3MpCiAgKTsKICBpbnQgZm9yd2FyZF90b25fYW1vdW50ID0gaW5fbXNnX2JvZHl+bG9hZF9jb2lucygpOwoKICBpbnQgdG9uX2JhbGFuY2VfYmVmb3JlX21zZyA9IG15X3Rvbl9iYWxhbmNlIC0gbXNnX3ZhbHVlOwogIGludCBzdG9yYWdlX2ZlZSA9IG1pbl90b25zX2Zvcl9zdG9yYWdlKCkgLSBtaW4odG9uX2JhbGFuY2VfYmVmb3JlX21zZywgbWluX3RvbnNfZm9yX3N0b3JhZ2UoKSk7CiAgbXNnX3ZhbHVlIC09IChzdG9yYWdlX2ZlZSArIGdhc19jb25zdW1wdGlvbigpKTsKICBpZihmb3J3YXJkX3Rvbl9hbW91bnQpIHsKICAgIG1zZ192YWx1ZSAtPSAoZm9yd2FyZF90b25fYW1vdW50ICsgZndkX2ZlZSk7CiAgICBzbGljZSBlaXRoZXJfZm9yd2FyZF9wYXlsb2FkID0gaW5fbXNnX2JvZHk7CgogICAgdmFyIG1zZ19ib2R5ID0gYmVnaW5fY2VsbCgpCiAgICAgICAgLnN0b3JlX3VpbnQob3A6OnRyYW5zZmVyX25vdGlmaWNhdGlvbiwgMzIpCiAgICAgICAgLnN0b3JlX3VpbnQocXVlcnlfaWQsIDY0KQogICAgICAgIC5zdG9yZV9jb2lucyhqZXR0b25fYW1vdW50KQogICAgICAgIC5zdG9yZV9zbGljZShmcm9tX2FkZHJlc3MpCiAgICAgICAgLnN0b3JlX3NsaWNlKGVpdGhlcl9mb3J3YXJkX3BheWxvYWQpCiAgICAgICAgLmVuZF9jZWxsKCk7CgogICAgdmFyIG1zZyA9IGJlZ2luX2NlbGwoKQogICAgICAuc3RvcmVfdWludCgweDEwLCA2KSA7OyB3ZSBzaG91bGQgbm90IGJvdW5jZSBoZXJlIGNhdXNlIHJlY2VpdmVyIGNhbiBoYXZlIHVuaW5pdGlhbGl6ZWQgY29udHJhY3QKICAgICAgLnN0b3JlX3NsaWNlKG93bmVyX2FkZHJlc3MpCiAgICAgIC5zdG9yZV9jb2lucyhmb3J3YXJkX3Rvbl9hbW91bnQpCiAgICAgIC5zdG9yZV91aW50KDEsIDEgKyA0ICsgNCArIDY0ICsgMzIgKyAxICsgMSkKICAgICAgLnN0b3JlX3JlZihtc2dfYm9keSk7CgogICAgc2VuZF9yYXdfbWVzc2FnZShtc2cuZW5kX2NlbGwoKSwgMSk7CiAgfQoKICBpZiAoKHJlc3BvbnNlX2FkZHJlc3MucHJlbG9hZF91aW50KDIpICE9IDApICYgKG1zZ192YWx1ZSA+IDApKSB7CiAgICB2YXIgbXNnID0gYmVnaW5fY2VsbCgpCiAgICAgIC5zdG9yZV91aW50KDB4MTAsIDYpIDs7IG5vYm91bmNlIC0gaW50X21zZ19pbmZvJDAgaWhyX2Rpc2FibGVkOkJvb2wgYm91bmNlOkJvb2wgYm91bmNlZDpCb29sIHNyYzpNc2dBZGRyZXNzIC0+IDAxMDAwMAogICAgICAuc3RvcmVfc2xpY2UocmVzcG9uc2VfYWRkcmVzcykKICAgICAgLnN0b3JlX2NvaW5zKG1zZ192YWx1ZSkKICAgICAgLnN0b3JlX3VpbnQoMCwgMSArIDQgKyA0ICsgNjQgKyAzMiArIDEgKyAxKQogICAgICAuc3RvcmVfdWludChvcDo6ZXhjZXNzZXMsIDMyKQogICAgICAuc3RvcmVfdWludChxdWVyeV9pZCwgNjQpOwogICAgc2VuZF9yYXdfbWVzc2FnZShtc2cuZW5kX2NlbGwoKSwgMik7CiAgfQoKICBzYXZlX2RhdGEoYmFsYW5jZSwgb3duZXJfYWRkcmVzcywgamV0dG9uX21hc3Rlcl9hZGRyZXNzLCBqZXR0b25fd2FsbGV0X2NvZGUpOwp9CgooKSBidXJuX3Rva2VucyAoc2xpY2UgaW5fbXNnX2JvZHksIHNsaWNlIHNlbmRlcl9hZGRyZXNzLCBpbnQgbXNnX3ZhbHVlLCBpbnQgZndkX2ZlZSkgaW1wdXJlIHsKICA7OyBOT1RFIHdlIGNhbiBub3QgYWxsb3cgZmFpbHMgaW4gYWN0aW9uIHBoYXNlIHNpbmNlIGluIHRoYXQgY2FzZSB0aGVyZSB3aWxsIGJlCiAgOzsgbm8gYm91bmNlLiBUaHVzIGNoZWNrIGFuZCB0aHJvdyBpbiBjb21wdXRhdGlvbiBwaGFzZS4KICAoaW50IGJhbGFuY2UsIHNsaWNlIG93bmVyX2FkZHJlc3MsIHNsaWNlIGpldHRvbl9tYXN0ZXJfYWRkcmVzcywgY2VsbCBqZXR0b25fd2FsbGV0X2NvZGUpID0gbG9hZF9kYXRhKCk7CiAgaW50IHF1ZXJ5X2lkID0gaW5fbXNnX2JvZHl+bG9hZF91aW50KDY0KTsKICBpbnQgamV0dG9uX2Ftb3VudCA9IGluX21zZ19ib2R5fmxvYWRfY29pbnMoKTsKICBzbGljZSByZXNwb25zZV9hZGRyZXNzID0gaW5fbXNnX2JvZHl+bG9hZF9tc2dfYWRkcigpOwogIGNlbGwgY3VzdG9tX3BheWxvYWQgPSBpbl9tc2dfYm9keX5sb2FkX2RpY3QoKTsKICBiYWxhbmNlIC09IGpldHRvbl9hbW91bnQ7CiAgdGhyb3dfdW5sZXNzKDcwNSwgZXF1YWxfc2xpY2VzKGpldHRvbl9tYXN0ZXJfYWRkcmVzcywgc2VuZGVyX2FkZHJlc3MpKTsKICB0aHJvd191bmxlc3MoNzA2LCBiYWxhbmNlID49IDApOwogIHRocm93X3VubGVzcyg3MDcsIG1zZ192YWx1ZSA+IGZ3ZF9mZWUgKyAyICogZ2FzX2NvbnN1bXB0aW9uKCkpOwoKICB2YXIgbXNnX2JvZHkgPSBiZWdpbl9jZWxsKCkKICAgIC5zdG9yZV91aW50KG9wOjpidXJuX25vdGlmaWNhdGlvbiwgMzIpCiAgICAuc3RvcmVfdWludChxdWVyeV9pZCwgNjQpCiAgICAuc3RvcmVfY29pbnMoamV0dG9uX2Ftb3VudCkKICAgIC5zdG9yZV9zbGljZShvd25lcl9hZGRyZXNzKQogICAgLnN0b3JlX3NsaWNlKHJlc3BvbnNlX2FkZHJlc3MpCiAgICAuc3RvcmVfZGljdChjdXN0b21fcGF5bG9hZCkKICAgIC5lbmRfY2VsbCgpOwoKICB2YXIgbXNnID0gYmVnaW5fY2VsbCgpCiAgICAuc3RvcmVfdWludCgweDE4LCA2KQogICAgLnN0b3JlX3NsaWNlKGpldHRvbl9tYXN0ZXJfYWRkcmVzcykKICAgIC5zdG9yZV9jb2lucygwKQogICAgLnN0b3JlX3VpbnQoMSwgMSArIDQgKyA0ICsgNjQgKyAzMiArIDEgKyAxKQogICAgLnN0b3JlX3JlZihtc2dfYm9keSk7CgogIHNlbmRfcmF3X21lc3NhZ2UobXNnLmVuZF9jZWxsKCksIDY0KTsKCiAgc2F2ZV9kYXRhKGJhbGFuY2UsIG93bmVyX2FkZHJlc3MsIGpldHRvbl9tYXN0ZXJfYWRkcmVzcywgamV0dG9uX3dhbGxldF9jb2RlKTsKfQoKKCkgb25fYm91bmNlIChzbGljZSBpbl9tc2dfYm9keSkgaW1wdXJlIHsKICBpbl9tc2dfYm9keX5za2lwX2JpdHMoMzIpOyA7OyAweEZGRkZGRkZGCiAgKGludCBiYWxhbmNlLCBzbGljZSBvd25lcl9hZGRyZXNzLCBzbGljZSBqZXR0b25fbWFzdGVyX2FkZHJlc3MsIGNlbGwgamV0dG9uX3dhbGxldF9jb2RlKSA9IGxvYWRfZGF0YSgpOwogIGludCBvcCA9IGluX21zZ19ib2R5fmxvYWRfdWludCgzMik7CiAgdGhyb3dfdW5sZXNzKDcwOSwgKG9wID09IG9wOjppbnRlcm5hbF90cmFuc2ZlcikgfCAob3AgPT0gb3A6OmJ1cm5fbm90aWZpY2F0aW9uKSk7CiAgaW50IHF1ZXJ5X2lkID0gaW5fbXNnX2JvZHl+bG9hZF91aW50KDY0KTsKICBpbnQgamV0dG9uX2Ftb3VudCA9IGluX21zZ19ib2R5fmxvYWRfY29pbnMoKTsKICBiYWxhbmNlICs9IGpldHRvbl9hbW91bnQ7CiAgc2F2ZV9kYXRhKGJhbGFuY2UsIG93bmVyX2FkZHJlc3MsIGpldHRvbl9tYXN0ZXJfYWRkcmVzcywgamV0dG9uX3dhbGxldF9jb2RlKTsKfQoKKCkgcmVjdl9pbnRlcm5hbChpbnQgbXlfYmFsYW5jZSwgaW50IG1zZ192YWx1ZSwgY2VsbCBpbl9tc2dfZnVsbCwgc2xpY2UgaW5fbXNnX2JvZHkpIGltcHVyZSB7CiAgaWYgKGluX21zZ19ib2R5LnNsaWNlX2VtcHR5PygpKSB7IDs7IGlnbm9yZSBlbXB0eSBtZXNzYWdlcwogICAgcmV0dXJuICgpOwogIH0KCiAgc2xpY2UgY3MgPSBpbl9tc2dfZnVsbC5iZWdpbl9wYXJzZSgpOwogIGludCBmbGFncyA9IGNzfmxvYWRfdWludCg0KTsKICBpZiAoZmxhZ3MgJiAxKSB7CiAgICBvbl9ib3VuY2UoaW5fbXNnX2JvZHkpOwogICAgcmV0dXJuICgpOwogIH0KICBzbGljZSBzZW5kZXJfYWRkcmVzcyA9IGNzfmxvYWRfbXNnX2FkZHIoKTsKICBjc35sb2FkX21zZ19hZGRyKCk7IDs7IHNraXAgZHN0CiAgY3N+bG9hZF9jb2lucygpOyA7OyBza2lwIHZhbHVlCiAgY3N+c2tpcF9iaXRzKDEpOyA7OyBza2lwIGV4dHJhY3VycmVuY3kgY29sbGVjdGlvbgogIGNzfmxvYWRfY29pbnMoKTsgOzsgc2tpcCBpaHJfZmVlCiAgaW50IGZ3ZF9mZWUgPSBjc35sb2FkX2NvaW5zKCk7IDs7IHdlIHVzZSBtZXNzYWdlIGZ3ZF9mZWUgZm9yIGVzdGltYXRpb24gb2YgZm9yd2FyZF9wYXlsb2FkIGNvc3RzCgogIGludCBvcCA9IGluX21zZ19ib2R5fmxvYWRfdWludCgzMik7CgogIGlmIChvcCA9PSBvcDo6dHJhbnNmZXIpIHsgOzsgb3V0Z29pbmcgdHJhbnNmZXIKICAgIHNlbmRfdG9rZW5zKGluX21zZ19ib2R5LCBzZW5kZXJfYWRkcmVzcywgbXNnX3ZhbHVlLCBmd2RfZmVlKTsKICAgIHJldHVybiAoKTsKICB9CgogIGlmIChvcCA9PSBvcDo6aW50ZXJuYWxfdHJhbnNmZXIpIHsgOzsgaW5jb21pbmcgdHJhbnNmZXIKICAgIHJlY2VpdmVfdG9rZW5zKGluX21zZ19ib2R5LCBzZW5kZXJfYWRkcmVzcywgbXlfYmFsYW5jZSwgZndkX2ZlZSwgbXNnX3ZhbHVlKTsKICAgIHJldHVybiAoKTsKICB9CgogIGlmIChvcCA9PSBvcDo6YnVybikgeyA7OyBidXJuCiAgICBidXJuX3Rva2Vucyhpbl9tc2dfYm9keSwgc2VuZGVyX2FkZHJlc3MsIG1zZ192YWx1ZSwgZndkX2ZlZSk7CiAgICByZXR1cm4gKCk7CiAgfQoKICB0aHJvdygweGZmZmYpOwp9CgooaW50LCBzbGljZSwgc2xpY2UsIGNlbGwpIGdldF93YWxsZXRfZGF0YSgpIG1ldGhvZF9pZCB7CiAgcmV0dXJuIGxvYWRfZGF0YSgpOwp9";

describe("Exit code parser", () => {
  it("parses the exit code", async () => {
    const exitCodes = await parseExitCodes(
      Buffer.from(code, "base64").toString(),
      fs.readFileSync("public/tree-sitter.wasm"),
      fs.readFileSync("public/tree-sitter-func.wasm"),
    );
    expect(exitCodes).toEqual(["0xffff", "705", "706", "707", "708", "709"]);
  });
});
